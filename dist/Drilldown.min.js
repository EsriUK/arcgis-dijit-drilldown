require({ cache: { "esriuk/dijit/Locators/PickListItem": function () {define(["dojo/_base/declare"],function(a){return a(null,{Description:"",Addresses:[],Level:0,SortDescription:"",constructor:function(b){this.Description="",this.Addresses=[],this.Level=0,this.SortDescription="",a.safeMixin(this,b)},addCandidate:function(a){this.Addresses.push(a)}})});},"esriuk/dijit/Locators/PickList": function () {define(["dojo/_base/declare"],function(a){return a(null,{PickListItems:[],constructor:function(){this.PickListItems=[]},addItem:function(a){this.PickListItems.push(a)}})});},"esriuk/dijit/Locators/_LocatorBase": function () {String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";var b,c,d,e,f,g=0;if(void 0===this||null===this)throw new TypeError;if(b=Object(this),c=b.length>>>0,"function"!=typeof a)throw new TypeError;for(d=[],e=arguments.length>=2?arguments[1]:void 0,g=0;c>g;g++)g in b&&(f=b[g],a.call(e,f,g,b)&&d.push(f));return d}),define(["dojo/_base/declare","esri/tasks/locator","./PickList","./PickListItem","dojo/Deferred"],function(a,b,c,d,e){var f=function(a,b){var c,d,e=0,f=a.length,g="",h=[];for(e=0;f>e;e+=1)c=a[e],d=b[c],d.length>0&&h.push(d);return h.length>0&&(g=h.join(", ")),g},g=function(a,b,c,e){var g,h,i,j=0,k=0;for(j=0,k=a.length;k>j;j+=1)g=a[j],h=g.attributes,i=f(e,h),i.length>0&&(b.hasOwnProperty(i)?b[i].addCandidate(g):b[i]=new d({SortDescription:i,Description:i,Addresses:[g],Level:2}))},h=function(a,b){return a.localeCompare(b)},i=function(a,b){function c(a){for(var b,c,d=[],e=0,f=-1,g=0;b=(c=a.charAt(e++)).charCodeAt(0);){var h=46==b||b>=48&&57>=b;h!==g&&(d[++f]="",g=h),d[f]+=c}return d}var d=c(a),e=c(b);for(x=0;d[x]&&e[x];x++)if(d[x]!==e[x]){var f=Number(d[x]),g=Number(e[x]);return f==d[x]&&g==e[x]?f-g:d[x]>e[x]?1:-1}return d.length-e.length};return a([b],{locatorType:"None",streetGrouping:[],premiseGrouping:[],paoFields:{PAO_TEXT:"",PAO_START_NUMBER:"",PAO_START_SUFFIX:"",PAO_END_NUMBER:"",PAO_END_SUFFIX:""},saoFields:{SAO_TEXT:"",SAO_START_NUMBER:"",SAO_START_SUFFIX:"",SAO_END_NUMBER:"",SAO_END_SUFFIX:""},_geocodeHandler:function(a,b,d,e,f){var g=this;try{this.resultsPickList=new c,this._buildPickList(a).then(function(){g._successHandler([g.resultsPickList],"onAddressToLocationsComplete",d,f)})}catch(h){this._errorHandler(h,e,f)}},_getListLevelDescription:function(a,b){var c="",d=this.streetFields;this.paoFields;switch(a){case 1:c=[this._getPAOText(b,!1),b[d.STREET_DESCRIPTOR],b[d.LOCALITY_NAME],b[d.TOWN_NAME],b[d.ADMINISTRATIVE_AREA]].filter(Boolean).join(", ");break;case 2:c=[b[d.STREET_DESCRIPTOR],b[d.LOCALITY_NAME],b[d.TOWN_NAME],b[d.ADMINISTRATIVE_AREA]].filter(Boolean).join(", ")}return c},_buildPickList:function(a){var b,j,k,l,m,n,o,p,q=new e,r={},s={},t=0,u=0,v=new c,w=this.streetFields.STREET_DESCRIPTOR,x=this.streetGrouping,y=this.premiseGrouping,z=function(a,b){return h(a.SortDescription,b.SortDescription)},A=function(a,b){return i(a.SortDescription,b.SortDescription)};if(a.candidates.length>0){b=a.candidates,g(b,r,w,x);for(k in r)if(r.hasOwnProperty(k))if(s={},r[k].Addresses.length>1){for(l=new d({Description:k,SortDescription:r[k].SortDescription}),m=r[k].Addresses,t=0,u=m.length;u>t;t+=1)p=m[t].attributes,j=f(y,p),o=null,j.length>0&&(o=m[t],o.SortDescription=this._getSAOText(p,!0),s.hasOwnProperty(j)?s[j].addCandidate(o):s[j]=new d({SortDescription:this._getPAOText(p,!0),Description:this._getListLevelDescription(1,p),Addresses:[o],Level:1}));for(n in s)s.hasOwnProperty(n)&&(s[n].Addresses.sort(A),l.addCandidate(s[n]));l.Addresses.sort(A),v.addItem(l)}else v.addItem(r[k]);v.PickListItems.sort(z),this.resultsPickList=v,q.resolve()}else this.resultsPickList=v,q.resolve();return q.promise}})});},"esriuk/dijit/Locators/AGSLLPGLocator": function () {define(["dojo/_base/declare","./_LocatorBase"],function(a,b){var c=function(a){return void 0===a||null===a||""===a};return a([b],{locatorType:"AGS_LLPG",resultsPickList:null,streetGrouping:["StreetDescriptor","LocalityName","Town","AdminArea"],premiseGrouping:["PAOText","PAONumberRange"],streetFields:{STREET_DESCRIPTOR:"StreetDescriptor",LOCALITY_NAME:"LocalityName",TOWN_NAME:"Town",ADMINISTRATIVE_AREA:"AdminArea"},paoFields:{PAO_TEXT:"PAOText",PAO_START_NUMBER:"PAO_START_NUMBER",PAO_START_SUFFIX:"PAO_START_SUFFIX",PAO_END_NUMBER:"PAO_END_NUMBER",PAO_END_SUFFIX:"PAO_END_SUFFIX",PAONumberRange:"PAONumberRange"},saoFields:{SAO_TEXT:"SAOText",SAO_START_NUMBER:"SAO_START_NUMBER",SAO_START_SUFFIX:"SAO_START_SUFFIX",SAO_END_NUMBER:"SAO_END_NUMBER",SAO_END_SUFFIX:"SAO_END_SUFFIX",SAONumberRange:"SAONumberRange"},constructor:function(){this.inherited(arguments)},_getPAOText:function(a,b){var d="",e="";return c(a[this.paoFields.PAO_TEXT])!==!1||b||(d=a[this.paoFields.PAO_TEXT].trim()),e=a[this.paoFields.PAONumberRange].trim(),c(e)===!1&&(d+=e),d.trim()},_getSAOText:function(a,b){var d="",e="";return c(a[this.saoFields.SAO_TEXT])!==!1||b||(d=a[this.saoFields.SAO_TEXT].trim()),e=a[this.saoFields.SAONumberRange].trim(),c(e)===!1&&(d+=e),d.trim()}})});},"esriuk/dijit/Locators/LLPGLocator": function () {define(["dojo/_base/declare","./_LocatorBase"],function(a,b){var c=function(a){return void 0===a||null===a||""===a},d=function(a,b,d,e){var f=a.trim()+b.trim(),g=d.trim()+e.trim();return c(f)===!1&&c(g)===!1?f+"-"+g:f+g};return a([b],{locatorType:"LLPG",resultsPickList:null,streetGrouping:["STREET_DESCRIPTOR","LOCALITY_NAME","TOWN_NAME","ADMINISTRATIVE_AREA"],premiseGrouping:["PAO_TEXT","PAO_END_SUFFIX","PAO_END_NUMBER","PAO_START_SUFFIX","PAO_START_NUMBER"],streetFields:{STREET_DESCRIPTOR:"STREET_DESCRIPTOR",LOCALITY_NAME:"LOCALITY_NAME",TOWN_NAME:"TOWN_NAME",ADMINISTRATIVE_AREA:"ADMINISTRATIVE_AREA"},paoFields:{PAO_TEXT:"PAO_TEXT",PAO_START_NUMBER:"PAO_START_NUMBER",PAO_START_SUFFIX:"PAO_START_SUFFIX",PAO_END_NUMBER:"PAO_END_NUMBER",PAO_END_SUFFIX:"PAO_END_SUFFIX"},saoFields:{SAO_TEXT:"SAO_TEXT",SAO_START_NUMBER:"SAO_START_NUMBER",SAO_START_SUFFIX:"SAO_START_SUFFIX",SAO_END_NUMBER:"SAO_END_NUMBER",SAO_END_SUFFIX:"SAO_END_SUFFIX"},constructor:function(){this.inherited(arguments)},_getPAOText:function(a,b){var e="",f="",g=this.paoFields;return c(a[g.PAO_TEXT])!==!1||b||(e=a[g.PAO_TEXT].trim()),f=d(a[g.PAO_START_NUMBER],a[g.PAO_START_SUFFIX],a[g.PAO_END_NUMBER],a[g.PAO_END_SUFFIX]),c(f)===!1&&(e+=" "+f),e.trim()},_getSAOText:function(a,b){var e="",f="",g=this.saoFields;return c(a[g.SAO_TEXT])!==!1||b||(e=a[g.SAO_TEXT].trim()),f=d(a[g.SAO_START_NUMBER],a[g.SAO_START_SUFFIX],a[g.SAO_END_NUMBER],a[g.SAO_END_SUFFIX]),c(f)===!1&&(e+=" "+f),e.trim()}})});},"esriuk/dijit/Drilldown": function () {Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","esri/dijit/Search","dojo/dom-construct","dijit/layout/ContentPane","dijit/TitlePane","dojox/widget/TitleGroup","dojo/on","dojo/Deferred","dojo/query","dojo/NodeList-data"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(a){return void 0===a||null===a||""===a},n=function(a,b){var c=f.toDom("<span class='drilldownResult'>"+a+"</span>");return l(c).data("result",b),c},o=function(a,b){return!m(a)&&a.length>0&&b?"<span class='drilldownCount'>"+a.length+"</span>":""},p=function(a,b,c){var d=0,e=0,f=new i,j=a.Addresses;for(d=0,e=j.length;e>d;d+=1)f.addChild(new g({content:[n(j[d].address,j[d]),"<span class='drilldownResultIcon'></span>"]}));b.addChild(new h({title:o(j,c)+"<span class='drilldownTitle'>"+a.Description+"</span>",content:f,open:!1}))},q=function(a,b){var c,d,e=0,f=0,h=new i;if(!m(a.Addresses)&&a.Addresses.length>1){for(c=a.Addresses,e=0,f=c.length;f>e;e++)!m(c[e].Addresses)&&c[e].Addresses.length>1?p(c[e],h,b):(d=m(c[e].address)?n(c[e].Addresses[0].address,c[e].Addresses[0]):n(c[e].address,c[e]),h.addChild(new g({content:[d,"<span class='drilldownResultIcon'></span>"]})));h.startup()}else m(a.Addresses[0].address)?!m(a.Addresses[0].Addresses)&&a.Addresses[0].Addresses.length>0&&p(a.Addresses[0],h):h=new g({content:n(a.Addresses[0].address,a.Addresses[0])});return h},r=function(a,b){this.get("contentSet")===!1&&(this.set("content",q(a,b)),this.set("contentSet",!0))};return a([b,c,d,e],{baseClass:"drilldown",widgetsInTemplate:!0,resultsElement:null,_titleGroups:[],showCounts:!1,constructor:function(b){a.safeMixin(this,b)},destroy:function(){this._clearPicklist(),this.inherited(arguments)},search:function(){var a=this,b=new k;return this.inherited(arguments).then(function(c){a._buildPickListUi(c),b.resolve()}),b.promise},clear:function(){this._clearPicklist(),this.inherited(arguments)},_hydrateResults:function(a){return a.PickListItems?a:this.inherited(arguments)},_formatResults:function(a,b,c){var d={activeSourceIndex:b,value:c,numResults:0,numErrors:0,errors:null,results:null},e={},f={},g=0;if(a){if(b===this._allIndex){for(g=0;g<a.length;g++)m(this.sources[g].locator.locatorType)?d=this.inherited(arguments):(f[b]=a[0],d.numResults+=a[0].PickListItems.length);return d.results=f,d.err=e,d}return m(this.activeSource.locator.locatorType)?this.inherited(arguments):(f[b]=a[0],d.numResults+=a[0].PickListItems.length,d.results=f,d.err=e,d)}return d},_clearPicklist:function(){var a,b;if(this._titleGroups.length>0){for(a=0,b=this._titleGroups.length;b>a;a++)this._titleGroups[a].destroy();this._titleGroups=[]}},_showNoResults:function(){this._noResults(this.value),this._showNoResultsMenu()},_isSingleResult:function(a){var b,c,d,e=0;for(d in a)a.hasOwnProperty(d)&&(e++,c=d);if(1===e){if(b=a[c].PickListItems,1===b.length&&1===b[0].Addresses.length){if(m(b[0].Addresses[0].Addresses))return!0;if(!m(b[0].Addresses[0].Addresses)&&1===b[0].Addresses[0].Addresses.length)return!0}return!1}return!1},_buildPickListUi:function(a){var b,c,d,e,g,n,p=this,s=0,t=0,u=!1,v=new k;if(this._clearPicklist(),f.destroy(this.resultsElement),this.resultsElement=f.create("div",{"class":"arcgisSearch searchGroup picklistResults"},this.domNode,"last"),p.activeSourceIndex!==this._allIndex&&this._isSingleResult(a))e=this._hydrateResult(a[p.activeSourceIndex].PickListItems[0].Addresses[0],p.activeSourceIndex,!1),this.select(e);else{if(!m(a)){for(d in a)if(a.hasOwnProperty(d))if(m(a[d])||m(a[d].PickListItems))u=!0;else if(b=a[d].PickListItems,t=b.length,t>0)for(g=f.create("div",{id:d},this.resultsElement,"last"),c=new i(null,g),this._titleGroups.push(c),s=0;t>s;s+=1)n=new h({title:o(b[s].Addresses,this.showCounts)+"<span class='drilldownTitle'>"+b[s].Description+"</span>",open:!1,contentSet:!1}),1===t?(n.set("open",!0),n.set("contentSet",!0),n.set("content",q(b[s],this.showCounts))):n.own(n.on("click",r.bind(n,b[s],this.showCounts))),c.addChild(n),u=!1;else u=!0;v.resolve()}u&&this._showNoResults(),m(this.resultsElement)||j(this.resultsElement,".drilldownResult:click",function(){var a=l(this).data()[0],b=p._hydrateResult(a.result,p.activeSourceIndex,!1);p.select(b),p._clearPicklist()})}return v.promise}})});} } });